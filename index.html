<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maze Escape</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <link rel="manifest" href="manifest.json">

    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">


    <!-- Horror Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Creepster&family=Nosifer&family=Butcherman&family=East+Sea+Dokdo&family=Roboto+Slab:wght@400;700&family=Eater&family=Metal+Mania&family=Jolly+Lodger&family=Kirang+Haerang&family=Yeon+Sung&family=Gaegu&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <!-- 3D 게임이 렌더링될 캔버스 컨테이너 -->
    <canvas id="game-canvas"></canvas>
    <div id="disguise-overlay"></div>
    <div id="bitten-overlay"></div>

    <!-- 미니맵 HUD -->
    <div id="minimap-container">
        <canvas id="minimap-canvas"></canvas>
    </div>



    <!-- UI Overlay Container -->
    <div id="ui-overlay">
        <!-- 상단 중앙 정보 -->
        <div id="top-hud">
            <div id="hud-stage" class="hud-item">
                <span class="label">STAGE</span>
                <div class="stage-control">
                    <button id="prev-stage-btn" class="nav-btn">&lt;</button>
                    <span class="count highlight">1</span>
                    <button id="next-stage-btn" class="nav-btn">&gt;</button>
                </div>
            </div>
            <div id="hud-stats-row">
                <div class="stat-compact">
                    <span class="icon">⏱️</span>
                    <span id="stat-time" class="value">00:00</span>
                </div>
                <div class="stat-separator"></div>
                <div class="stat-compact">
                    <span class="icon">👣</span>
                    <span id="stat-moves" class="value">0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 하단 체력 바 (Horror Health Bar) -->
    <div id="health-bar-container" class="hidden">
        <div class="health-frame">
            <div id="health-fill"></div>
            <div class="health-glitch"></div>
        </div>
        <!-- <div class="health-text">VITALITY</div> -->
    </div>

    <!-- 360도 사운드 레이더 -->
    <div id="radar-container">
        <div class="radar-circle"></div>
    </div>



    <!-- 우측 상단 메뉴 버튼 -->
    <button id="menu-btn" title="메뉴">☰</button>

    <div id="cheat-hud">
        <!-- 기존 치트 버튼 유지 (메뉴 버튼 추가됨) -->
        <button id="cheat-btn" title="치트 실행">😈</button>
    </div>

    <!-- 인게임 메뉴 팝업 -->
    <div id="ingame-menu-popup" class="ui-popup hidden">
        <div class="ui-popup-content">
            <h2>PAUSE</h2>
            <div class="menu-options">
                <button id="close-menu-btn" class="ui-btn">계속하기</button>
                <button id="restart-btn" class="ui-btn">다시하기</button>
                <button id="ingame-settings-btn" class="ui-btn">설정</button>
                <button id="main-menu-btn" class="ui-btn">나가기</button>
            </div>
        </div>
    </div>

    <!-- 사망 화면 (Death Screen) -->
    <div id="death-screen" class="ui-popup hidden">
        <div class="ui-popup-content">
            <h2>YOU DIE</h2>
            <div class="menu-options">
                <button id="death-restart-btn" class="ui-btn">다시 도전</button>
                <button id="death-main-menu-btn" class="ui-btn">메인 메뉴</button>
            </div>
        </div>
    </div>

    <div id="game-hud">
        <!-- status-panel 제거 (아이콘에 통합) -->
    </div>



    <!-- 아이템 액션 버튼 (좌측 세로 정렬) -->
    <div id="item-actions">
        <div class="action-btn locked hidden" id="use-jump-btn" title="특수 점프 (소모성)">
            <span class="icon">➰</span>
            <span class="count">0</span>
        </div>
        <div id="use-flashlight-btn" class="action-btn locked hidden" title="손전등 온오프">
            <span class="icon">🔦</span>
            <div class="battery-bar-container">
                <div class="battery-bar-fill"></div>
            </div>
        </div>

        <!-- 사운드 센서 버튼 -->
        <div id="use-sensor-btn" class="action-btn locked hidden" title="사운드 센서 온오프">
            <span class="icon">📡</span>
            <div class="battery-bar-container">
                <div class="battery-bar-fill"></div>
            </div>
        </div>

        <div id="use-c4-btn" class="action-btn locked hidden" title="C4 폭 가설">
            <span class="icon">🧨</span>
            <span class="count">0</span>
        </div>
        <div id="use-trap-btn" class="action-btn locked hidden" title="함정 설치">
            <span class="icon">🕸️</span>
            <span class="count">0</span>
        </div>
        <div id="use-teleport-btn" class="action-btn locked hidden" title="순간이동">
            <span class="icon">🔮</span>
            <span class="count">0</span>
        </div>
        <div id="use-disguise-btn" class="action-btn locked hidden" title="가면 착용 (10초)">
            <span class="icon">🎭</span>
            <span class="count">0</span>
        </div>
    </div>

    <!-- 스플래시 화면 오버레이 -->
    <div id="splash-screen">
        <div class="content">
            <h1>MAZE ESCAPE</h1>
            <p>화면을 클릭하여 시작하세요.</p>
        </div>
    </div>

    <!-- 설정 팝업 -->
    <div id="settings-popup" class="ui-popup hidden">
        <div class="popup-content settings-content">
            <div class="popup-header">
                <h2>설정</h2>
                <button id="close-settings-btn" class="close-btn">&times;</button>
            </div>

            <div class="popup-body settings-body">
                <div class="setting-item">
                    <div class="setting-label">
                        <span>배경 음악 (BGM)</span>
                        <span id="bgm-volume-val" class="val-label">100%</span>
                    </div>
                    <input type="range" id="bgm-volume-slider" min="0" max="100" value="100">
                </div>

                <div class="setting-item">
                    <div class="setting-label">
                        <span>효과음 (SFX)</span>
                        <span id="sfx-volume-val" class="val-label">100%</span>
                    </div>
                    <input type="range" id="sfx-volume-slider" min="0" max="100" value="100">
                </div>

                <div class="setting-item">
                    <div class="setting-label">
                        <span>날씨 효과음</span>
                        <span id="weather-volume-val" class="val-label">100%</span>
                    </div>
                    <input type="range" id="weather-volume-slider" min="0" max="100" value="100">
                </div>

                <hr class="settings-divider">

                <div class="setting-item nickname-setting">
                    <div class="setting-label">
                        <span>플레이어 닉네임</span>
                        <span id="nickname-status" class="status-msg"></span>
                    </div>
                    <div class="nickname-input-group">
                        <input type="text" id="nickname-input" placeholder="닉네임 입력 (2~12자)" maxlength="12">
                        <button id="save-nickname-btn" class="ui-btn small">저장</button>
                    </div>
                </div>
            </div>

            <div class="settings-footer">
                <button id="settings-ok-btn" class="ui-btn">확인</button>
            </div>
        </div>
    </div>

    <!-- 메인 메뉴 화면 오버레이 -->
    <div id="main-menu-screen" class="ui-popup main-menu-overlay hidden">
        <div class="main-menu-container">
            <div class="menu-options minimalist-menu">
                <button id="new-game-button" class="menu-link-btn">새게임</button>
                <button id="continue-button" class="menu-link-btn disabled">이어하기</button>
                <button id="settings-button" class="menu-link-btn">설정</button>
                <button id="rankings-button" class="menu-link-btn">랭킹</button>
                <button id="help-button" class="menu-link-btn">도움말</button>
            </div>
        </div>
    </div>

    <!-- 랭킹 팝업 -->
    <div id="rankings-popup" class="ui-popup hidden">
        <div class="popup-content ranking-content">
            <div class="popup-header">
                <h2>GLOBAL RANKINGS</h2>
                <button id="close-rankings-btn" class="close-btn">&times;</button>
            </div>
            <div class="popup-body ranking-body">
                <div class="ranking-header">
                    <span class="col-rank">RANK</span>
                    <span class="col-nickname">NICKNAME</span>
                    <span class="col-stage">STAGE</span>
                    <span class="col-time">TIME</span>
                    <span class="col-turn">TURN</span>
                </div>
                <div id="ranking-list-container">
                    <div class="ranking-loading">불러오는 중...</div>
                </div>
                <div id="my-ranking-container" class="my-ranking-section hidden">
                    <!-- 유저 개인 순위가 여기에 표시됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 도움말 팝업 (Help Popup) -->
    <div id="help-popup" class="ui-popup hidden">
        <div class="popup-content"> <!-- Keeps specific class for internal layout override -->
            <div class="popup-header">
                <h2>게임 가이드</h2>
                <button id="close-help-btn" class="close-btn">&times;</button>
            </div>

            <div class="popup-body">
                <!-- 조작 방법 섹션 -->
                <section class="help-section">
                    <h3>🕹️ OPERATION PROTOCOL</h3>
                    <div class="control-group">
                        <div class="control-column">
                            <h4>PC (KEYBOARD)</h4>
                            <ul>
                                <li><span class="key">↑</span><span class="key">↓</span> : 전진 / 후진</li>
                                <li><span class="key">←</span><span class="key">→</span> : 시점 회전</li>
                                <li class="control-item"><span class="key">Space</span> <span class="icon"
                                        id="control-icon-jump"></span> 수직 도약 (Jump)</li>
                                <li class="control-item"><span class="key">F</span> <span class="icon"
                                        id="control-icon-flashlight"></span> 전술 조명 (Flashlight)</li>
                                <li class="control-item"><span class="key">T</span> <span class="icon"
                                        id="control-icon-sensor"></span> 음파 탐지 (Sonar)</li>
                                <li class="control-item"><span class="key">C</span> <span class="icon"
                                        id="control-icon-c4"></span> 구조물 파괴 (C4)</li>
                                <li class="control-item"><span class="key">Q</span> <span class="icon"
                                        id="control-icon-teleport"></span> 차원 전이 (Warp)</li>
                                <li class="control-item"><span class="key">R</span> <span class="icon"
                                        id="control-icon-trap"></span> 구속 함정 (Trap)</li>
                                <li class="control-item"><span class="key">G</span> <span class="icon"
                                        id="control-icon-mask"></span> 생체 위장 (Disguise)</li>
                                <li class="control-item"><span class="key">Esc</span> <span class="icon"
                                        id="control-icon-menu"></span> 메뉴 토글 (Menu)</li>
                            </ul>
                        </div>
                        <div class="control-column">
                            <h4>모바일 (터치)</h4>
                            <ul>
                                <li><span class="gesture">스와이프 ↕</span> : 전진 / 후진</li>
                                <li><span class="gesture">스와이프 ↔</span> : 시점 회전</li>
                                <li><span class="gesture">UI 터치</span> : 아이템 사용</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <hr class="divider">

                <!-- 아이템 가이드 섹션 -->
                <section class="help-section">
                    <h3>📦 SURVIVAL GEAR</h3>
                    <div class="item-grid">
                        <div class="item-card">
                            <span class="icon" id="help-icon-flashlight"></span>
                            <div class="info">
                                <strong>전술 조명 (Flashlight)</strong>
                                <p>심연의 어둠을 밝히는 필수 장비입니다. 전력 소모 시 꺼지며, 비활성화 시 자동 충전됩니다.</p>
                            </div>
                        </div>
                        <div class="item-card">
                            <span class="icon" id="help-icon-sensor"></span>
                            <div class="info">
                                <strong>음파 탐지기 (Sonar)</strong>
                                <p>초음파를 발사하여 주변의 위협(좀비)을 시각화합니다. 사용 시 전력이 소모됩니다.</p>
                            </div>
                        </div>
                        <div class="item-card">
                            <span class="icon" id="help-icon-jump"></span>
                            <div class="info">
                                <strong>도약 장치 (Jump)</strong>
                                <p>압축 스프링을 이용해 수직으로 뛰어오릅니다. 공중에서 주변 미로 구조를 파악하세요.</p>
                            </div>
                        </div>
                        <div class="item-card">
                            <span class="icon" id="help-icon-c4"></span>
                            <div class="info">
                                <strong>C4 폭약 (C4)</strong>
                                <p>가로막힌 벽을 파괴하여 새로운 경로를 개척합니다. 폭발 반경 내에 있지 않도록 주의하십시오.</p>
                            </div>
                        </div>
                        <div class="item-card">
                            <span class="icon" id="help-icon-teleport"></span>
                            <div class="info">
                                <strong>차원 전이 장치 (Warp)</strong>
                                <p>알 수 없는 차원의 힘을 빌어 미로 내 무작위 위치로 즉시 전이합니다.</p>
                            </div>
                        </div>
                        <div class="item-card">
                            <span class="icon" id="help-icon-trap"></span>
                            <div class="info">
                                <strong>압착 함정 (Bear Trap)</strong>
                                <p>강력한 스프링 함정을 설치합니다. 좀비를 수 초간 그 자리에 구속할 수 있습니다.</p>
                            </div>
                        </div>
                        <div class="item-card">
                            <span class="icon" id="help-icon-mask"></span>
                            <div class="info">
                                <strong>생체 위장 (Disguise)</strong>
                                <p>특수한 마스크를 착용하여 좀비들이 자신을 동족으로 착각하게 만듭니다.</p>
                            </div>
                        </div>
                        <div class="item-card">
                            <span class="icon" id="help-icon-map"></span>
                            <div class="info">
                                <strong>낡은 양피지 (Map)</strong>
                                <p>미로의 구조를 처음부터 재구축합니다. 탈출 경로를 잃었을 때의 최후의 수단입니다.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <script type="module" src="./main.js"></script>
</body>

</html>